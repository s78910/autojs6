<div align="center">
<h1><a >小米社区自动化脚本</a></h1>

</div>

## **项目介绍**
#### 原作者：  @PJxiaoyu  
#### 修改： 风中拾叶 
#### 三改： wengzhenquan
* 此脚本是基于AutoJs6，依靠安卓无障碍服务的小米社区自动化脚本
* 区别于青龙面板，该脚本免登录，模拟真人操作，类似“按键精灵”、连续点击APP。
* 支持的功能：
  * 定时解锁手机（密码，图案）
  * 浏览帖子
  * 签到验证码识别
  * 社区各种成长值任务
  * 小程序签到
  * 成长值记录
  * ......

* $\color{red}{如果你担心使用自动化脚本签到会导致被检测拉黑，请不要使用此脚本。}$  

---  
## **效果展示：**  
![image](说明/效果展示1.jpg)  
![image](说明/效果展示2.jpg)  
![image](说明/效果展示.jpg)  


--- 
## **正式开始：**  

[脚本下载入口](https://github.com/wengzhenquan/autojs6/releases)   

$\color{red}{小提示：不同版本可以共存，主程序放在同一个目录下即可。}$  
$\color{red}{配置文件都是共用的，新版本也会兼容旧版本配置。}$    

主程序：`小社脚本.js`  
配置文件：`config.js`  
临时工作目录：`tmp/`  

**AutoJs6**   
建议使用最新版   
[点击下载](https://github.com/SuperMonster003/AutoJs6/releases)  



--- 
**支持跳转小程序版 社区APP下载：**  

[网盘下载](https://www.123912.com/s/RYmDVv-bwUch)  
[备用地址](https://www.123865.com/s/RYmDVv-bwUch)   


--- 
## 使用方法：  
**1. 先授权AutoJs6需要的权限。**  

   免root建议`Shizuku`体验更好。  
   有root推荐授权root权限。  
   
   $\color{red}{最后一个权限需要Shizuku，或者root才能开启！}$   
   
   页面需要的权限如下：
    ![image](说明/需要的权限.jpg)  
    
   $\color{red}{额外权限： 后台弹出界面权限}$   
    
   ``` 
   小米手机：长按AutoJs6图标→应用详情→权限管理→其它权限→后台弹出界面。  
   Vivo、Oppo：听说有。
   其它手机：不知道，有些手机不需要手动打开这个权限，默认允许。 
   ```  
--- 
**2. 更改autojs6工作路径。**  
    ![image](说明/更改工作路径.jpg)  
    
   允许使用中文，目录在`sdcard/`下。  

--- 
**3. 将脚本解压到工作路径下。**  

   你可以修改文件夹名称，里面的文件别改名就行。  
   $\color{red}{更新版本的时候，如果config.js配置文件没有变化，只需下载小社脚本.js，放在同一个目录里即可。}$   
 

--- 
**4. 在AutoJs6找到脚本，脚本如下：**  
    ![image](说明/主界面.jpg)  

--- 
**5. 编辑配置文件`config.js`：**  
    ![image](说明/配置文件说明.jpg)  

   配置文件里面都有详细说明：  
   
   设置屏幕解锁密码，能够设置定时任务，在夜间自动解锁进行签到。  
   依葫芦画瓢，有多少个点位，就多少行`[横坐标x, 纵坐标y]`。  
   按解锁顺序，从上到下排列。  
   
   **$\color{red}{如果是数字密码，就不用考虑坐标问题。}$**  
   **将“解锁方式”改成2** ，第2行， $\color{red}{输入数字密码}$ 。  
   
   **$\color{red}{如果没有密码，}$** 啥也不用管，程序会自动识别解锁状态。   
   
   $\color{red}{图形锁的坐标获取：（需要Shizuku或者root权限）}$   
   
   autojs6→左侧菜单（权限那一页）→浮动按钮（第3个），会看到一个悬浮小工具。  
   点击悬浮小工具→…→指针位置。    
    ![image](说明/获取坐标工具.jpg)    
    
--- 
**~6. 小米社区小程序图标，必须放在桌面~**  
   **$\color{red}{（社区APP若支持跳转小程序，可忽略该操作）。}$**  
   
   
   在微信小程序里面，右上角“…”→添加到桌面，即可。  
   $\color{red}{不可藏在文件夹里！！！}$   
     
  
   `坐标点击: 0,` ：从桌面自动搜索小图标，无论放在哪一屏（**推荐**）。  

   `坐标点击: 1,` ：从第3屏指定坐标点击启动小程序，坐标获取方法与上面一样（**不推荐**）。**（如果你确定这样做了，那么图标必须放在第3屏！）**     
   
   
   **小米社区微信小程序调用优先级：**  
   
   从小米社区APP调用 >   
   （配置 $\color{red}{坐标点击: 1,}$）第3屏指定”坐标”寻找 >   
   （配置 $\color{red}{坐标点击: 0,}$）自动搜索桌面所有屏幕   
   
   小米社区APP 5.3.2以上版本才支持从社区APP调用。  
   $\color{red}{页面开头已提供5.3.2以上版本下载地址}$  
   **页面开头已提供5.3.2以上版本下载地址**   
   
   ```
   注：桌面自动搜索功能，如果在桌面上存在多个[小米社区]图标（微信分身，或社区APP），那么会选择位置顺序靠前面的那一个。    
      如果打开了社区APP，会回到桌面，然后尝试打开下一个图标，直到打开小程序为止。    
      **调换图标位置，让小程序图标靠前，无疑可以加快流程耗时。**     
      或者把社区APP图标藏进桌面的某个文件夹里，让程序找不到。
   ```
--- 

**7.完成！试跑！定时任务！**   

   ![image](说明/定时任务.jpg)  

   试跑：  
    配置好了以后，先试跑一下。   
    第一次试跑，把需要的权限都授权了。  
    确保脚本可以完成所有流程，然后设置定时任务。  
    **别忘了测试在锁屏状态下能否顺利解锁。**   

  **$\color{red}{执行过程可能发生错误。}$**  
    出现任何问题，先查看本页面下方的 **问题收集** ，下面收录了大多数遇到的问题，并且同时也在更新。   
 
   想定时，保证全自动化进行，必须打开 **$\color{red}{“投影媒体权限”}$**！   
   想流程减少错误，请确保AutoJs6拥有 **$\color{red}{“后台弹出界面”权限}$**！   
   （小米手机肯定有打开入口，其它手机自己找找，如果没有，就确保“悬浮窗”、“显示在应用上层”等权限都开启！）    
 
   调试成功后，建议设置 $\color{red}{2个定时任务}$，原因如下：   
   1. 执行过程中可能发生错误。   
 
   程序运行时间：40秒~1:30 (不会超过2分钟，超过肯定就是出错了！）   
 
 
--- 
**10. 你还在等什么？哪来的8、9？赶快启动试试啊！成功了就定时任务甩起！**   
   
   好吧，那就来个10吧！    
   
   **APP打包版本下载地址？**   
   ```
   APP打包版（不推荐使用）
   
   www.123912.com/s/RYmDVv-A5uch
   
   提取码：GjHi
   
   
   注意：必须手动给它开启“后台弹出界面”权限，否则无法直接调起小米社区。
   
   （点击APP会自动开始运行，程序会自动后台。
   等程序运行完毕，从后台切换过去，可查看日志。）
   
   存在的问题：
   1、无障碍权限容易掉，授权比较麻烦。
   2、无法设置定时任务（也许需要借助其它软件让它定时启动）。  
   3、不支持修改配置，内置`坐标点击: 0,`，自动桌面搜索小程序图标。  
   4、不支持屏幕解锁。  
   6、无法开启`投影媒体权限`，否则每次都需要点`立即开始`，无法做到全自动化。  
   （想授权`投影媒体权限`，免root用户可以借助 `APP ops`这款APP。）
   （root用户可以借助 `Thanox`这款APP。）
   链接里我都放了！
   
   总结：完全是[动手版]，难以释放双手，无法自动化。
   
   ```

----   
## 问题收集：

   **1. $\color{red}{布局分析失效}$ 是什么意思？**   
   
   就是AutoJs6无法识别该页面的元素，比如“论坛”文本，“签到”按钮等等。  
   ```    
   无法识别，也就无法判断这些元素是否已经加载、展示。  
   微信小程序里面，这个现象频发。   
   可能不兼容的因素：
     1、安卓版本
     2、AutoJS6版本
     3、微信版本
   跟脚本没关系，我只能改成用坐标点击，不能保证成功。
   如果想要避免，可以尝试更换上面几个软件的版本来解决。   
   注意：不一定高版本就好，尝试降低版本说不定有奇效。
   ```  
   
   **2. 为什么明明已经打开小程序，依旧报“进不了微信小程序，我尽力了！”？**  
   
   因为布局分析失效了，无法检测到小程序是否已经打开。   
   `config.js`里，有个 $\color{red}{[跳过小程序打开验证 : 0]}$ 改成1即可。   
   
    
   **3. 什么是“排水沟过弯大法”？我的手机有时候无法启动小米社区？**
   $\color{red}{（缺少“后台弹出界面”权限）}$   
   
   
   **4.无法解锁屏幕/没有点击图标/没有点击……**  
   
   $\color{red}{重新授权“无障碍”权限，然后重启手机，即可解决。}$   
   ```
   锁屏无法上滑；
   日志提示已点击，但实际上没有点击（比如识图认证，从桌面打开小程序图标）。
   这些都是“无障碍”权限故障导致的问题。
   可能是刚升级AutoJS6，需要重新授权。
   也有可能，就是无障碍权限掉了……
   看下面问题5
   
   ```
   **5.无障碍服务已启用但未运行/无障碍服务老掉**  
   ```
   1、确保开启'忽略电池优化'
   [[ 自启动白名单 / 忽略电池优化 / 忽略后台活动限制 / 系统多任务保留 ] 等.]
   2、重启无障碍服务
   3、重启手机
   ```
   若有墓碑、杀后台程序，可以尝试加入白名单。    
   可以尝试第三方无障碍管理器用来保活，比如： $\color{red}{无障碍管理器}$ （酷安搜索，或上面第10步网盘链接有）   
   
   
   **6.为什么我按[音量+]键无法停止脚本？**  
   听说， $\color{red}{重启手机}$ 会有效果，一般人我不告诉他！
   
   ```  
   原因1： 监听音量键被占用。
        可以尝试AutoJs6→设置→打开“音量加”键控制脚本。
        开启、关闭，这个功能，尝试在开关这个按钮的情况下，脚本是否有效。
        反正我代码里面写了。
        被AutoJs6本身占用，也有可能无法激活。
        
   原因2： 可能被手机厂商限制监听功能。
        比如在小米澎湃2的环境下，该功能可能就失效。
        目前还没实现通过广播功能实现监听。
   
   ```
   
   **7.为什么我点击`停止脚本`按钮无法停止脚本？显示“关不掉！x1”。**  
   点击已经成功了， $\color{red}{继续点击}$ ，你一定可以停止成功的。
   
   ```  
   原因： 我也不知道为什么，应该是AutoJS6设计上的问题，
         停止不能强制执行，只能通知式执行。
         在某些操作正在执行的时候，可能无法停止。
         最终结果不能确定。
         反正失败了就继续点就是。
         
   ```
   
   **8. 要开始使用AutoJs6录制或投放内容吗？每次需要手动点“立即开始”。**  
     
   $\color{red}{需要开启“投影媒体权限”，才能自动跳过这一步。}$  
   
   ```
   免root用户(有电脑)：下载adb工具，复制开启“投射媒体权限”的命令执行，相关过程自行查询。  
   
   免root用户(有Shizuku)：AutoJS6获得Shizuku授权，点击开启按钮，可直接开启。  
   
   root用户：AutoJs6获得root权限，点击开启按钮，直接开启。  
   ```
   **等等，我的AutoJs6没有这个选项？**  
   啊！你用的是什么古老版本？   
   
   如果不想升级AutoJs6？怎么开启“投射媒体权限”？   
   （免root用户可以借助 `Shizuku + APP ops`这款APP。）   
   （root用户可以借助 `Thanox`这款APP。）    
    (上面使用步骤10，APP打包版的链接里面，已上传这两款APP。)   
   
   **9. 方法images.requestScreenCapture()调用失败。**  
   （截图权限无法通过）
   
   这是 $\color{red}{“投影媒体权限”}$ 获取异常导致的。
   尝试以下方法之后，再运行脚本。
   ```
   1、检查“`投影媒体权限`”，是否开启。
   2、重启AutoJs6。
   3、重启手机。
   ```
   经过我多次尝试，直接重启手机无疑是最有效的。  
   如果是偶发现象，那就再加一个定时任务好了！  
   
   
   

--- 
## 作者的废话：
   ```
   多次测试，中途遇到各种意外不能执行下去，都写了补偿方案，实现plan B。  
   
   原本600多行的代码，扩写到了2000多行。
   能够兼容大部分机型，兼容大部分安卓版本，减少错误率。   
   即便不是小米手机，也无所畏惧。
   
   不论如何，我的建议是设置两个定时任务。  
   每个间隔3分钟以上（正常走完一次，2分钟内能执行完毕）。  
   多次执行，就不怕漏签了。或者早上几个，晚上几个，多多益善。  
   
   ```
  
   
--- 


原作者  by：PJ小宇    QQ：898811295

修改    by：风中拾叶

三改   by：wengzhenquan（就是俺啦）   
github：https://github.com/wengzhenquan/autojs6


--- 

v3.4.13：
1. 双旗舰活动，布局分析失效，模拟点击
2. 将解锁程序提前，放在验权之前



v3.4.12：
1. 添加无障碍服务权限检查
2. 停止脚本按钮修改点击文案（关不掉继续点）
3. 修复双旗舰活动识别不出有次数问题
4. 修复第一次关闭程序没有生效问题

v3.4.11：
1. 添加ClawCloud Run 服务器地址
2. 抹黑签到兼容经典导航键
3. 优化若干

v3.4.10：
1. 小程序摸黑签到坐标优化。
2. 优化双旗舰活动关闭“炫耀一下”坐标。
3. 添加网络权限检查。

v3.4.9：
1. 修复从社区APP跳转小程序时，遇到分身无法自动选择问题。
2. 增多锁屏上滑次数。
3. 优化一部分逻辑。


v3.4.8：
1. 修复在AutoJS 6.5.0环境下，请求超时失效问题。   
(各位一定要尽快更新AutoJS6版本，也要更新脚本版本。代码写的越多，发现旧版越多bug，想要兼容旧版，就要改写，好费劲啊！)

v3.4.7：
1. 一些优化。
2. 修复点击“停止脚本”后，静音、亮度未恢复问题。
3. 修复旧版本开盒活动无法开盒问题。

v3.4.6：
1. 跳过广告
2. 确保tmp目录存在

v3.4.5：
1. 添加服务器提前异步检查。  
2. 小小的优化，不值一提。

v3.4.4：
1. 修复了一些兼容性bug，主要针对旧版安卓。  
2. 添加多台服务器验证，优化逻辑，增加可行性、可用性。

v3.4.3：
1. 兼容旧版本安卓。  
2. 美化日志，适应旧版安卓。  
3. 修复装逼控制台样式失效问题。
4. AutoJS 6.5.0兼容性改造。

v3.4.2：
1. 添加社区APP、微信版本号验证。

v3.4.1：
1. 修改一些日志文案。
2. 左下角，添加停止脚本悬浮窗按钮。

v3.4:
1. 添加异常打印输出。  
2. 优化小程序摸黑签到逻辑。
3. 添加通知静音、结束震动配置。
4. 添加小程序摸黑签到自定义坐标。
5. 删除已弃用的配置，con、totaltime，这两货在程序里也是没用的一段代码。


v3.3:
1. 添加设置媒体静音功能。   
2. 添加设置运行屏幕亮度功能。   
3. 修复小程序布局分析失败时，卡主问题。   
4. 添加布局分析失败，从社区APP重新打开逻辑。   
5. 调整运行顺序：   
    APP签到完→小程序签到（去除小程序成长值统计）；  
    开盒子放到最后，以免小程序签到完，成长值又足够开盒子；  
    成长值数据，只用社区APP统计，放在程序最后，以免小程序统计不准确；  
(看起来好乱！)

v3.2.3:
1. 修复微信模拟进入小程序下滑失败问题。
2. 修复微信分身下，APP调用小程序识别错误。
3. 修复自适配分辨率坐标没点击问题。

v3.2.2:
1. 优化一些识别逻辑。
2. 添加屏幕解锁失败重试逻辑。
3. 提高识图签到自适应分辨率准确度。
4. 修复微信分身下，APP调用小程序识别错误。

v3.2.1:
1. 调整控制台，在签到页控制台高度收缩为20%，签到完成恢复。 
2. 等待小程序打开时间延长到10秒。 
3. 请求服务器超时改为10秒，且添加@风中拾叶大佬的请求地址。   
4. 服务器部分优化，加快请求速度。  
5. 主程序改名为“小社脚本”，就是“小（米）”、“社（区）”各留第一个字。  
(改名主要是看到风中拾叶的脚本开始用跟本脚本一样的命名规则，加个v，这样就不好共存了啊！)  

v3.2:
1. 延长从社区APP调用小程序的等待时间。
2. 终于实现识图签到了，是风中拾叶写的Python，和训练的模型。
（几经波折，由于AutoJS6不支持调用模型，所以最后把模型放在了服务器上跑，需要请求服务器，需要4~7秒的时间。）
（虽然删除了hk目录，但是滑块签到的逻辑还是保留的，转移到tmp路径，反正已经实现自动适配了。说不定哪天小米又换过来了呢？）
（感谢@风中拾叶 大佬（@fgvsuiye）的辛苦奉献）


 [更新历史](说明/更新历史.md)
