******************************************************************
*   __autojs需要各种权限，左侧边栏内的权限都打开可解决大部分问题！！__

*   __部分手机需要打开 $\color{red}{后台弹出界面}$ 的权限，否则无法自动启动社区__

*    __需将验证码界面截图，自行裁切滑块保存hk/hk_分辨率.png__

*    __ $\color{red}{小提示：APP脚本打包版，地址在下面第10步！}$ __

******************************************************************

原作者@PJxiaoyu、@fgvsuiye

已适配：1080x2400、1200x2670、1220x2712、1440x2960、1440x3200  

其它分辨率可能出错！  
需要截图hg.png图片，改名为 h_分辨率.png，放置在hk目录下。  

**（3.1.2版本已实现 $\color{red}{自动适配}$ 功能，如果滑块签到移动不准确，用户再考虑手动适配吧！）**      

感谢以下热心大佬提供的适配：  
酷安“Wordr”提供：1440x2960、1440x3200  
酷安“小严不严”提供：1220x2712   
酷安“凯凯很努力”提供：1200x2670

(愿意提供支适配的，可以把滑块截图hk_分辨率.png发issues，要原图。)  

--- 
**正式开始：**  

[脚本下载入口](https://github.com/wengzhenquan/autojs6/releases)   

$\color{red}{小提示：不同版本可以共存，主程序放在同一个目录下即可。}$  
$\color{red}{配置文件都是共用的，新版本也会兼容旧版本配置。}$    

**更新规则**  
```
配置文件有更新，就更新第二位版本号，3.x
没有更新配置文件，就更新第三位版本号，3.0.y
（更新配置文件config.js，记得备份，把原来的配置转移过去）
```


**AutoJs6**   
建议使用最新版   
[点击下载](https://github.com/SuperMonster003/AutoJs6/releases)  


--- 
## 使用方法：  
**1. 先授权AutoJs6需要的权限。**  

   没root就开启“无障碍服务”，免root建议Shizuku体验更好。  
   有root推荐授权root权限。  
   
   $\color{red}{最后一个权限需要Shizuku，或者root才能开启！}$   
   
   页面需要的权限如下：
    ![image](说明/需要的权限.jpg)  
    
   $\color{red}{额外权限： 后台弹出界面权限}$   
   如果总是提示“排水沟过弯”，无法直接启动社区APP，调用某个程序流程总是进行不下去，
   可能缺少后台弹出界面权限。    
   但是这个权限并不是每一个品牌手机都有开启入口。   
   ``` 
   小米手机：长按AutoJs6图标→应用详情→权限管理→其它权限→后台弹出界面。  
   华为手机：听说有。
   其它手机：不知道，有些手机不需要手动这个权限，默认允许。 
   ```  
--- 
**2. 更改autojs6工作路径。**  
   允许使用中文，目录在sdcard/下。  
    ![image](说明/更改工作路径.jpg)  

--- 
**3. 将脚本解压到工作路径下。**  
   你可以修改文件夹名称，里面的文件别改名就行。  
   $\color{red}{更新版本的时候，如果config.js配置文件没有变化，只需下载主程序.js，放在同一个目录里即可。}$   
 

--- 
**4. 在AutoJs6找到脚本，脚本如下：**  
    ![image](说明/主界面.jpg)  

--- 
**5. 编辑配置文件：**  
    ![image](说明/配置文件说明.jpg)  

   配置文件里面都有详细说明：  
   
   设置屏幕解锁密码，能够设置定时任务，在夜间自动解锁进行签到。  
   依葫芦画瓢，有多少个点位，就多少行[横坐标x, 纵坐标y]。  
   按解锁顺序，从上到下排列。  
   
   **$\color{red}{如果是数字密码，就不用考虑坐标问题。}$**  
   **将“解锁方式”改成2** ，第2行， $\color{red}{输入数字密码}$ ！。  
   
   **$\color{red}{如果没有密码，}$** 啥也不用管，程序会自动识别解锁状态。   
   
   $\color{red}{图形锁的坐标获取：（需要Shizuku或者root权限）}$   
   
   autojs6→菜单→浮动按钮（第3个），会看到一个小悬浮窗小工具。  
   小工具→…→指针位置。    
    ![image](说明/获取坐标工具.jpg)    
    
      

--- 
**6. ~~截图获取滑块hk.png文件。~~**  
**（3.1.2版本已经实现 $\color{red}{自动适配}$，如果滑块签到移动不准确，用户再考虑手动适配吧！）**      


   ~~（非2400*1080分辨率的手机请注意，是这个分辨率的不用管。） ~~ 
    
   
   ~~这张图片是在1080分辨率的手机下截图的，~~  
   **如果你的手机不能自动完成滑块签到，你可能需要自己截图剪切一张。**    
   
   然后放置在hk（滑块）目录，该目录为分辨率适配目录。  
   
   该图片用于自动滑块验证，来自小米社区签到页面的滑块截图。  
   
   **手动适配的分辨率文件都在hk/目录下。**  
   详情查看 → [hk/1、手机适配说明.txt](hk/1、手机适配说明.txt)  
   
   适配优先级：   
    hk目录下，有与本机分辨率对应的hk_分辨率.png图片时，优先以存在的图片适配。  
    否则自动适配，生成 hk_auto.png适配文件。   
    （所以，想手动适配改为自动的话，只需要把对应分辨率的hk截图重命名或者删除，让程序找不到即可！）  

--- 
**7. 小米社区小程序图标，必须放在桌面**  
   **$\color{red}{（小米社区APP里面有入口的话，可不用该操作）。}$**  
   在微信小程序里面，右上角“…”→添加到桌面，即可。  
   $\color{red}{不可藏在文件夹里！！！}$   
     
   （也可以通过填写坐标的方式指定位置，
   配置文件里， $\color{red}{坐标点击: 1,}$，坐标获取方法与上面一样。   
   $\color{red}{如果你确定这样做了，那么图标必须放在第3屏！}$ 。）     

   **如果在APP上调用失败，可以放一个小程序图标在桌面(任意屏)。**  
   **APP调用小程序失败的时候，会自动去桌面寻找，用作备用方案。**  
   
 
   **小米社区微信小程序调用优先级：**  
   
   从小米社区APP调用 >   
   （配置 $\color{red}{“坐标点击: 1,”}$）第3屏指定”坐标”寻找 >   
   （配置 $\color{red}{“坐标点击: 0,”}$）自动搜索桌面所有屏幕   
   
   小米社区APP 5.3.0以上版本才支持直接调用（ $\color{red}{如果入口存在的话}$）。 
   
   ```
   注：桌面自动搜索功能，如果在桌面上存在多个[小米社区]图标（微信分身，或社区APP），那么会选择位置顺序靠前面的那一个。    
      如果打开了社区APP，会回到桌面，然后尝试打开下一个图标，直到打开小程序为止。    
      **调换图标位置，让小程序图标靠前，无疑可以加快流程耗时。**     
      或者把社区APP图标藏进桌面的某个文件夹里，让程序找不到。
   ```
--- 

**8.完成！试跑！定时任务！**   

试跑：  
 配置好了以后，先试跑一下。   
 第一次试跑，把需要的权限都授权了。  
 确保脚本可以完成所有流程，然后设置定时任务。  
 别忘了测试是否能在锁屏转态下顺利解锁。 

  **$\color{red}{执行过程可能发生错误。}$**  
 出现如何问题，先查看本页面下方的 **问题收集** ，下面收录了大多数遇到的问题，并且同时也在更新。   
 
 想定时，保证全自动化进行，必须打开 **$\color{red}{“投影媒体权限”}$**！   
 想流程减少错误，请确保AutoJs6拥有 **$\color{red}{“后台弹出界面”权限}$**！   
 （小米手机肯定有打开入口，其它手机自己找找，如果没有，就确保“悬浮窗”、“显示在应用上层”等权限都开启！）  
 
   **$\color{red}{记得定时任务设置2-3次，中间间隔3分钟，以免运行出错，导致错过签到。}$**
 
--- 
**10. 你还在等什么？哪来的9？赶快启动试试啊！成功了就定时任务甩起！**   
   
   好吧，那就来个10吧！    
   
   **APP打包版本下载地址？**   
   ```
   APP打包版（不推荐使用）
   
   www.123912.com/s/RYmDVv-A5uch
   
   提取码：GjHi
   
   保证适配：1080x2400、1200x2670、1220x2712、1440x2960、1440x3200    
   （APP已实现自动适配！！！！！！）
   
   注意：必须手动给它开启“后台弹出界面”权限，否则无法直接调起小米社区。
   
   （点击APP会自动开始运行，程序会自动后台。
   等程序运行完毕，从后台切换过去，可查看日志。）
   
   存在的问题：
   1、无障碍权限容易掉，授权比较麻烦。
   2、无法设置定时任务（也许需要借助其它软件让它定时启动）。  
   3、不支持修改配置，内置“坐标点击: 0,”，自动桌面搜索小程序图标。  
   4、不支持屏幕解锁。  
   5、自1.3版本开始，已经实现自动适配分辨率，但不一定成功。
   6、无法“投影媒体权限”，否则每次都需要点“立即开始”，无法做到全自动化。  
   （想授权“投影媒体权限”，免root用户可以借助 “APP ops”这款APP。）
   （root用户可以借助 “Thanox”这款APP。）
   链接里我都放了！
   
   总结：完全是[动手版]，难以释放双手，无法自动化。
   
   ```

----   
## 问题收集：

   **1. “布局分析失效”是什么意思？**   
   
   就是AutoJs6无法识别该页面的元素，比如“论坛”文本，“签到”按钮等等。  
   ```    
   无法识别，也就无法判断这些元素是否已经加载、展示。  
   微信小程序里面，这个现象频发。   
   我猜测可能跟微信版本有关系，低版本的微信没什么问题。   
   ```  
   
   **2. 社区APP，签到滑块不准确，签到失败？**   
   
   那就手动适配hk_分辨率.png图片，放在hk目录下。   
   适配方法，hk目录下有个txt文档说明。   
   
   如果按照步骤操作以后，依旧不行，那就重新截图。   
   按照规律，图片的长和宽应该是一样的，可以参考其它图片的截图。   
   截图越精细，滑块准确率越高。   
   
   ```  
   自3.1.2版本开始，已经实现自动适配分辨率，但依旧采取手动适配优先原则。  
   在hk目录下，优先寻找能按照文件名规律适配的截图文件。
   如果截图不存在，才选择自动适配，程序截图一张名为hk_auto.png的滑块图片。 
    
   反之，把截图删了，或者重命名换个名字，就会自动适配啦！
   
   如果自动适配的滑块，签到移动不准确，用户再考虑手动适配吧！
   ```

   
   **3. 什么是“排水沟过弯大法”？我的手机有时候无法启动小米社区？**
   $\color{red}{（缺少“后台弹出界面”权限）}$   
   如果多次有如此提示，可以尝试手动给AutoJs6打开“后台弹出界面”权限。  
   
   ```
   程序在“应用信息”页面彻底结束“小米社区APP”之后，  
   会尝试直接以“唤起”的方式来启动小米社区。  
   是否唤起成功，这取决于当前手机运行状态。  
   
   如果多次唤起失败，就开始尝试从“应用信息”页面右上角进入“应用详情”页面，  
   这个页面有个“启动”按钮，从这里启动小米社区。 
   （小米手机是有的，其它手机我不知道有没有，
   如果没有的话，这个方案就无效了。） 
   
   这是补偿方案，也就是备用方案。  
   拐了一个弯，而不是直接唤起小米社区。  
   我称之，拓海大哥的过弯绝技，排水沟过弯大法。  
   ```
   **4. 为什么明明已经打开小程序，依旧报“进不了微信小程序，我尽力了！”？**  
   
   因为布局分析失效了，无法检测到小程序是否已经打开。   
   config.js 里，有个 $\color{red}{[跳过小程序打开验证 : 0]}$ 改成1即可。   
   （你说没有这个配置？可能你很久没更新配置了，更新配置记得备份原来的config.js，以便把配置转移过去。）
   ```  
   AutoJs6可能无法兼容最新版本的微信，无法对微信小程序进行布局分析。
   
   也可以尝试降低微信版本来解决这个问题。
   （要记得通过电脑版微信来备份聊天记录）。
   
   ```
   
   **5.为什么我按[音量+]键无法停止脚本？**  
   
   ```  
   原因1： 监听音量键被占用。
        可以尝试AutoJs6→设置→打开“音量加”键控制脚本。
        开启、关闭，这个功能，尝试在开关这个按钮的情况下，脚本是否有效。
        反正我代码里面写了。
        被AutoJs6本身占用，也有可能无法激活。
        
   原因2： 可能被手机厂商限制监听功能。
        比如在小米澎湃2的环境下，该功能可能就失效。
        目前还没实现通过广播功能实现监听。
   
   ```
   
   **6. 要开始使用AutoJs6录制或投放内容吗？每次需要手动点“立即开始”。**  
     
   $\color{red}{需要开启“投影媒体权限”，才能自动跳过这一步。}$  
   
   ```
   有电脑：下载adb工具，复制开启“投射媒体权限”的命令执行，相关过程自行查询。  
   
   无root，不想用电脑：可通过使用 Shizuku 获得 ADB 特权，可直接开启。  
   
   root用户：授权AutoJs6root权限，直接开启。  
   ```
   **等等，我的AutoJs6没有这个选项？**  
   啊！你用的是什么古老版本？   
   
   如果不想升级AutoJs6？怎么开启“投射媒体权限”？   
   （免root用户可以借助 Shizuku + “APP ops”这款APP。）   
   （root用户可以借助 “Thanox”这款APP。）    
    (上面使用步骤10，APP打包版的链接里面，已上传这两款APP。)   
   
   **7. 方法images.requestScreenCapture()调用失败。**  
   （截图权限无法通过）
   
   这是 $\color{red}{“投影媒体权限”}$ 获取异常导致的。
   尝试以下方法之后，再运行脚本。
   ```
   1、检查“投影媒体权限”，是否开启。
   2、重启AutoJs6。
   3、重启手机。
   ```
   经过我多次尝试，直接重启手机无疑是最有效的。  
   如果是偶发现象，那就再加一个定时任务好了！   
   
   
   **8. 为什么有时候“今日获得”成长值不正确？**
   
   因为 $\color{red}{布局分析失效了！}$，无法识别的到准确数据！  
   建议再加一个定时任务，从新获取一遍数据，在社区APP里面也采集了一遍成长值数据。   
   
   ```
   我也尝试过纠正，结果就是需要反复进入和退出成长值记录的页面，
   直到组件识别正确为止。
   这个动作可能会重复十几次。
   这无疑是很浪费时间，导致体验不佳。
   最后放弃了这个方案，把代码注释掉了。
   反正关注更多的是“当前成长值”，只要这个识别正确就行了。
   ```
   
   
   **9. 为什么小程序打开了没有动作？为什么不会自动打开“小米社区”APP？**  
   
   遇到这个问题应该是root用户，  
   并且使用了“隐藏应用列表”（lsposed），  
   当autojs6在隐藏应用列表中的时候，开启了数据隔离，  
   可能会造成对微信小程序、小米社区APP不可见，或者识别受阻现象。  
   ```
   解决：打开“隐藏应用列表”→应用管理→autojs6
   →开启白名单→额外可见的应用{微信、小米社区}，即可！
   ```
   

   **10. 为什么有时候报错，有时候又正常？**
     
   这跟AutoJs6、手机运行情况有关系。
   
   AutoJs6的因素：
   ```
   1、 每个版本略有差异，脚本是靠AutoJs6识别组件位置和层次。
      有的版本识别会缺一层，导致父组件不对。影响整体组件次序。
      我已经尽量做到改成兼容性强的方式来识别，但依旧有个别改不了。
      
   2、 AutoJs6使用多次会卡，导致内存堆积，拖慢整个手机。
       需要重启AutoJs6才能恢复。
       脚本里为了提升效率，寻找组件时间设置了限时，
       由于手机变慢，导致识别也会出现错误，甚至负值的坐标。
       
   3、不知道什么原因，重启AutoJs6能解决很多问题。
   ```
   
   手机的因素：
   ```
   1、 这种模拟脚本，不能直接调用接口的，失误率很高。
       不仅仅是误触问题，分辨率、主题布局，程序切换动画，都会有些影响。
       比如说，调用小米社区，APP不知道从哪个角落飞过来，
       动画长了点，然后脚本识别的又着急，可能识别到的瞬间，你动画还没停下，
       识别的坐标，变成“刻舟求剑”了！
       
   2、 手机环境也有影响。我手机“无障碍”残疾人就经常掉，开启状态不生效是什么鬼？
       因为要兼容免root，我关闭了对AutoJs6的root授权，结果老出问题。
       好像root开启之后，问题变得很少。我的“无障碍”有些问题，包括gkd也是有问题的。     
       
   3、 手机卡，反应速度慢，也有影响。
       我曾碰到一个用户，说解锁上滑不生效，最后排查问题后发现，是滑动速度太快，手机反应不过来。
       手机：刚刚什么东西飞过去了？
       最后把滑动时长改长了，就解决了。
   ```
   
   APP的因素：
   ```
   1、 不同版本APP，组件也有差异，容易造成识别错误。
       
   ```
   
   

--- 
## 作者的废话：
   ```
   我做的最多的修改，就是“大改”！！！  
   多次测试，中途遇到各种意外不能执行下去，都写了补偿方案。  
   要么循环调用，反复尝试。  
   要么换一种写法，要么干脆另辟蹊径再添加一种实现逻辑，实现plan B。  
   
   比如说，有时候直接调用小米社区失败。  
   反复调都不行，多次尝试后就找别的入口点击打开。  
   有时候进入微信小程序，无法直接进入，却启动了微信，那就模拟从小程序使用记录里面找。  
   有时候没问题，有时候又不行，根本不知道到底是什么原因导致的不稳定。  
   
   不论如何，我的建议是设置两个定时任务。  
   每个间隔3分钟以上（正常走完一次，2分钟内能执行完毕）。  
   多次执行，就不怕漏签了。或者早上几个，晚上几个，多多益善。  
   
   由于我就一部手机，没那么多测试用例可以测试，不过我真不想折腾了。  
   我又不是前端开发，不懂JS，该起来好费劲，一遍查稳定一遍改。  
   我只是自用，自己用出问题，稍微修改一下。  
   却等不到作者更新，我就自己越改越多，然后就这样了。。。  
   ```
  
   
--- 


原作者  by：PJ小宇    QQ：898811295

修改    by：风中拾叶

三改   by：wengzhenquan（就是俺啦）   
github：https://github.com/wengzhenquan/autojs6


---  

v3.1.2： 未发布    
1. 调整控制台大小，高度30%。程序结束调整成80%，展示8秒后退出。  
2. 添加Shizuku、root权限检查
3. 重写签到滑块滑动实现，减少计算量，加快签到流程。
4. 实现分辨率自动适配。   
（妈妈再也不用担心我手抖、眼睛不好了啦！）     

v3.1.1： 
1. 屏幕上滑动作改为1秒，增加一次上滑动作。
2. 小程序点击“我的”，使用可点击的父组件
3. 新增，“媒体投影权限”检测
4. “后台弹出界面”权限检测，添加对Vivo、OPPO、以及其它手机的支持
5. 新增，[音量键+]停止脚本运行。（配合“装逼控制台”食用，效果更明显。）   
(终于可以手动停止脚本运行啦！如果失败了，可能监听被占用，AutoJs6设置里有【使用“音量加键”控制脚本运行】，尝试打开关闭这个开关，再使用该功能。)



v3.1： 
1. 性能优化
2. 社区签到页加载失败处理
3. fix.浏览帖子bug
4. 新增配置“会装逼的控制台”，需要悬浮窗权限  
（啊~，没用的功能又增加啦！）


v3.0.2：   
1. 逻辑上的一些优化，让流程更流畅
2. 加快小程序启动速度
3. 增加小程序点击次数，增大打开成功率
4. 调整小程序摸黑签到坐标，添加点击次数
5. 日志调整，改短，适应字体大的手机

v3.0.1：   
1. fix.桌面只存在1个屏时，解锁判断失效    

v3.0： 
1. 活动有开盒子间隔3秒限制，添加3秒延迟，以防封号   
2. 优化部分代码，调整逻辑  
3. 添加处理，在APP签到页，由于加载卡顿，导致入口找不到的问题
4. fix.桌面打开小程序无法进入，但是却打开了微信问题
5. config.js增加配置“跳过小程序打开验证”，在小程序布局分析失效的时候，改成1   
（终于更新3.0版本，算初步完善了功能，这次配置有更新。）  
（以后配置文件有更新就更新第二位版本号，3.x） 
（没有更新配置文件，就更新第三位版本号，3.0.y）


 [更新历史](说明/更新历史.md)
