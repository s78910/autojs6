<div align="center">
<h1><a >小米社区自动化脚本</a></h1>

</div>

## **项目介绍**
#### 原作者：  @PJxiaoyu  
#### 修改： 风中拾叶 
#### 三改： wengzhenquan
* 此脚本是基于AutoJs6，依靠安卓无障碍服务的小米社区自动化脚本
* 区别于青龙面板，该脚本免登录，模拟真人操作，类似“按键精灵”、连续点击APP。
* 支持的功能：
  * 定时解锁手机（密码，图案）
  * 浏览帖子
  * 签到验证码识别
  * 社区各种成长值任务
  * 小程序签到
  * 成长值记录
  * ......

* $\color{red}{如果你担心使用自动化脚本签到会导致被检测拉黑，请不要使用此脚本。}$  

---  
## **效果展示：**  
![image](说明/效果展示1.jpg)  
![image](说明/效果展示2.jpg)  
![image](说明/效果展示.jpg)  


--- 
## **正式开始：**  

[脚本下载入口](https://github.com/wengzhenquan/autojs6/releases)   

$\color{red}{小提示：不同版本可以共存，主程序放在同一个目录下即可。}$  
$\color{red}{配置文件都是共用的，新版本也会兼容旧版本配置。}$    

主程序：`小社脚本.js`  
配置文件：`config.js`  
临时工作目录：`tmp/`  

**AutoJs6**   
建议使用最新版   
[点击下载](https://github.com/SuperMonster003/AutoJs6/releases)  



--- 
**支持跳转小程序版 社区APP下载：**  

**小米社区5.3.4**：[点击下载](https://api.hyperosupdates.com/apk/com.xiaomi.vipaccount_5.3.4_HyperOSUpdates.com.apk)   

**小米社区5.3.20250219 测试版**：[点击下载](https://api.hyperosupdates.com/apk/com.xiaomi.vipaccount_5.3.20250219_HyperOSUpdates.com.apk)   

--- 
## 使用方法：  
**1. 先授权AutoJs6需要的权限。**  

   没root就开启“无障碍服务”，免root建议`Shizuku`体验更好。  
   有root推荐授权root权限。  
   
   $\color{red}{最后一个权限需要Shizuku，或者root才能开启！}$   
   
   页面需要的权限如下：
    ![image](说明/需要的权限.jpg)  
    
   $\color{red}{额外权限： 后台弹出界面权限}$   
   如果总是提示“排水沟过弯”，无法直接启动社区APP，调用某个程序流程总是进行不下去，
   可能缺少后台弹出界面权限。    
   但是这个权限并不是每一个品牌手机都有开启入口。   
   ``` 
   小米手机：长按AutoJs6图标→应用详情→权限管理→其它权限→后台弹出界面。  
   华为手机：听说有。
   其它手机：不知道，有些手机不需要手动这个权限，默认允许。 
   ```  
--- 
**2. 更改autojs6工作路径。**  
   允许使用中文，目录在`sdcard/`下。  
    ![image](说明/更改工作路径.jpg)  

--- 
**3. 将脚本解压到工作路径下。**  
   你可以修改文件夹名称，里面的文件别改名就行。  
   $\color{red}{更新版本的时候，如果config.js配置文件没有变化，只需下载小社脚本.js，放在同一个目录里即可。}$   
 

--- 
**4. 在AutoJs6找到脚本，脚本如下：**  
    ![image](说明/主界面.jpg)  

--- 
**5. 编辑配置文件：**  
    ![image](说明/配置文件说明.jpg)  

   配置文件里面都有详细说明：  
   
   设置屏幕解锁密码，能够设置定时任务，在夜间自动解锁进行签到。  
   依葫芦画瓢，有多少个点位，就多少行`[横坐标x, 纵坐标y]`。  
   按解锁顺序，从上到下排列。  
   
   **$\color{red}{如果是数字密码，就不用考虑坐标问题。}$**  
   **将“解锁方式”改成2** ，第2行， $\color{red}{输入数字密码}$ 。  
   
   **$\color{red}{如果没有密码，}$** 啥也不用管，程序会自动识别解锁状态。   
   
   $\color{red}{图形锁的坐标获取：（需要Shizuku或者root权限）}$   
   
   autojs6→菜单→浮动按钮（第3个），会看到一个小悬浮窗小工具。  
   小工具→…→指针位置。    
    ![image](说明/获取坐标工具.jpg)    
    
--- 
**6. 小米社区小程序图标，必须放在桌面**  
   **$\color{red}{（小米社区APP若有入口，可忽略该操作）。}$**  
   在微信小程序里面，右上角“…”→添加到桌面，即可。  
   $\color{red}{不可藏在文件夹里！！！}$   
     
  
   `坐标点击: 0,` ：从桌面自动搜索小图标，无论放在哪一屏（**推荐**）。  

   `坐标点击: 1,` ：从第3屏指定坐标点击启动小程序，坐标获取方法与上面一样（**不推荐**）。**（如果你确定这样做了，那么图标必须放在第3屏！）**     
   
   
   **小米社区微信小程序调用优先级：**  
   
   从小米社区APP调用 >   
   （配置 $\color{red}{坐标点击: 1,}$）第3屏指定”坐标”寻找 >   
   （配置 $\color{red}{坐标点击: 0,}$）自动搜索桌面所有屏幕   
   
   小米社区APP 5.3.2以上版本才支持直接调用。（ $\color{red}{如果入口存在的话}$）。 
   
   ```
   注：桌面自动搜索功能，如果在桌面上存在多个[小米社区]图标（微信分身，或社区APP），那么会选择位置顺序靠前面的那一个。    
      如果打开了社区APP，会回到桌面，然后尝试打开下一个图标，直到打开小程序为止。    
      **调换图标位置，让小程序图标靠前，无疑可以加快流程耗时。**     
      或者把社区APP图标藏进桌面的某个文件夹里，让程序找不到。
   ```
--- 

**7.完成！试跑！定时任务！**   

![image](说明/定时任务.jpg)  

试跑：  
 配置好了以后，先试跑一下。   
 第一次试跑，把需要的权限都授权了。  
 确保脚本可以完成所有流程，然后设置定时任务。  
 别忘了测试在锁屏状态下能否顺利解锁。 

  **$\color{red}{执行过程可能发生错误。}$**  
 出现任何问题，先查看本页面下方的 **问题收集** ，下面收录了大多数遇到的问题，并且同时也在更新。   
 
 想定时，保证全自动化进行，必须打开 **$\color{red}{“投影媒体权限”}$**！   
 想流程减少错误，请确保AutoJs6拥有 **$\color{red}{“后台弹出界面”权限}$**！   
 （小米手机肯定有打开入口，其它手机自己找找，如果没有，就确保“悬浮窗”、“显示在应用上层”等权限都开启！）    
 
 调试成功后，建议设置 $\color{red}{2个定时任务}$，原因如下：   
  1. 执行过程中可能发生错误。   
 
 
--- 
**10. 你还在等什么？哪来的8、9？赶快启动试试啊！成功了就定时任务甩起！**   
   
   好吧，那就来个10吧！    
   
   **APP打包版本下载地址？**   
   ```
   APP打包版（不推荐使用）
   
   www.123912.com/s/RYmDVv-A5uch
   
   提取码：GjHi
   
   
   注意：必须手动给它开启“后台弹出界面”权限，否则无法直接调起小米社区。
   
   （点击APP会自动开始运行，程序会自动后台。
   等程序运行完毕，从后台切换过去，可查看日志。）
   
   存在的问题：
   1、无障碍权限容易掉，授权比较麻烦。
   2、无法设置定时任务（也许需要借助其它软件让它定时启动）。  
   3、不支持修改配置，内置`坐标点击: 0,`，自动桌面搜索小程序图标。  
   4、不支持屏幕解锁。  
   6、无法`投影媒体权限`，否则每次都需要点`立即开始`，无法做到全自动化。  
   （想授权`投影媒体权限`，免root用户可以借助 `APP ops`这款APP。）
   （root用户可以借助 `Thanox`这款APP。）
   链接里我都放了！
   
   总结：完全是[动手版]，难以释放双手，无法自动化。
   
   ```

----   
## 问题收集：

   **1. `布局分析失效`是什么意思？**   
   
   就是AutoJs6无法识别该页面的元素，比如“论坛”文本，“签到”按钮等等。  
   ```    
   无法识别，也就无法判断这些元素是否已经加载、展示。  
   微信小程序里面，这个现象频发。   
   我猜测可能跟微信版本有关系，低版本的微信没什么问题。   
   ```  
   
   **2. 为什么明明已经打开小程序，依旧报“进不了微信小程序，我尽力了！”？**  
   
   因为布局分析失效了，无法检测到小程序是否已经打开。   
   `config.js`里，有个 $\color{red}{[跳过小程序打开验证 : 0]}$ 改成1即可。   
   （你说没有这个配置？可能你很久没更新配置了，更新配置记得备份原来的config.js，以便把配置转移过去。）
   ```  
   AutoJs6可能无法兼容最新版本的微信，无法对微信小程序进行布局分析。
   
   也可以尝试降低微信版本来解决这个问题。
   （要记得通过电脑版微信来备份聊天记录）。
   
   ```
   
   
   **3. 什么是“排水沟过弯大法”？我的手机有时候无法启动小米社区？**
   $\color{red}{（缺少“后台弹出界面”权限）}$   
   如果多次有如此提示，可以尝试手动给AutoJs6打开“后台弹出界面”权限。  
   
   ```
   程序在“应用信息”页面彻底结束“小米社区APP”之后，  
   会尝试直接以“唤起”的方式来启动小米社区。  
   是否唤起成功，这取决于当前手机运行状态。  
   
   如果多次唤起失败，就开始尝试从“应用信息”页面右上角进入“应用详情”页面，  
   这个页面有个“启动”按钮，从这里启动小米社区。 
   （小米手机是有的，其它手机我不知道有没有，
   如果没有的话，这个方案就无效了。） 
   
   这是补偿方案，也就是备用方案。  
   拐了一个弯，而不是直接唤起小米社区。  
   我称之，拓海大哥的过弯绝技，排水沟过弯大法。  
   ```
  
   
   **4.为什么我按[音量+]键无法停止脚本？**  
   听说， $\color{red}{重启手机}$ 会有效果，一般人我不告诉他！
   
   ```  
   原因1： 监听音量键被占用。
        可以尝试AutoJs6→设置→打开“音量加”键控制脚本。
        开启、关闭，这个功能，尝试在开关这个按钮的情况下，脚本是否有效。
        反正我代码里面写了。
        被AutoJs6本身占用，也有可能无法激活。
        
   原因2： 可能被手机厂商限制监听功能。
        比如在小米澎湃2的环境下，该功能可能就失效。
        目前还没实现通过广播功能实现监听。
   
   ```
   
   **5. 要开始使用AutoJs6录制或投放内容吗？每次需要手动点“立即开始”。**  
     
   $\color{red}{需要开启“投影媒体权限”，才能自动跳过这一步。}$  
   
   ```
   有电脑：下载adb工具，复制开启“投射媒体权限”的命令执行，相关过程自行查询。  
   
   无root，不想用电脑：可通过使用 Shizuku 获得 ADB 特权，可直接开启。  
   
   root用户：授权AutoJs6root权限，直接开启。  
   ```
   **等等，我的AutoJs6没有这个选项？**  
   啊！你用的是什么古老版本？   
   
   如果不想升级AutoJs6？怎么开启“投射媒体权限”？   
   （免root用户可以借助 `Shizuku + APP ops`这款APP。）   
   （root用户可以借助 `Thanox`这款APP。）    
    (上面使用步骤10，APP打包版的链接里面，已上传这两款APP。)   
   
   **6. 方法images.requestScreenCapture()调用失败。**  
   （截图权限无法通过）
   
   这是 $\color{red}{“投影媒体权限”}$ 获取异常导致的。
   尝试以下方法之后，再运行脚本。
   ```
   1、检查“`投影媒体权限`”，是否开启。
   2、重启AutoJs6。
   3、重启手机。
   ```
   经过我多次尝试，直接重启手机无疑是最有效的。  
   如果是偶发现象，那就再加一个定时任务好了！   
   
   
   **7. 为什么有时候成长值统计不正确？**
   
   因为 $\color{red}{布局分析失效了！}$，无法识别的到准确数据！  
   建议再加一个定时任务，从新获取一遍数据，在社区APP里面也采集了一遍成长值数据。   
   
   ```
   我也尝试过纠正，结果就是需要反复进入和退出成长值记录的页面，
   直到组件识别正确为止。
   这个动作可能会重复十几次。
   这无疑是很浪费时间，导致体验不佳。
   最后放弃了这个方案，把代码注释掉了。
   反正关注更多的是“当前成长值”，只要这个识别正确就行了。
   ```
   
   
   **8. 为什么小程序打开了没有动作？为什么不会自动打开“小米社区”APP？**  
   
   遇到这个问题应该是root用户，  
   并且使用了“`隐藏应用列表`”（lsposed），  
   当autojs6在隐藏应用列表中的时候，开启了数据隔离，  
   可能会造成对微信小程序、小米社区APP不可见，或者识别受阻现象。  
   ```
   解决：打开“`隐藏应用列表`”→应用管理→autojs6
   →开启白名单→额外可见的应用{微信、小米社区}，即可！
   ```
   
   **9. 为什么社区APP里面没有点击坐标，日志里却提示已经点击？**   
   这是你手机问题，把所以权限关闭重新开启一下，特别是无障碍权限。  
   然后……重启手机！  
   

--- 
## 作者的废话：
   ```
   我做的最多的修改，就是“大改”！！！  
   多次测试，中途遇到各种意外不能执行下去，都写了补偿方案。  
   要么循环调用，反复尝试。  
   要么换一种写法，要么干脆另辟蹊径再添加一种实现逻辑，实现plan B。  
   
   比如说，有时候直接调用小米社区失败。  
   反复调都不行，多次尝试后就找别的入口点击打开。  
   有时候进入微信小程序，无法直接进入，却启动了微信，那就模拟从小程序使用记录里面找。  
   有时候没问题，有时候又不行，根本不知道到底是什么原因导致的不稳定。  
   
   不论如何，我的建议是设置两个定时任务。  
   每个间隔3分钟以上（正常走完一次，2分钟内能执行完毕）。  
   多次执行，就不怕漏签了。或者早上几个，晚上几个，多多益善。  
   
   由于我就一部手机，没那么多测试用例可以测试，不过我真不想折腾了。  
   我又不是前端开发，不懂JS，该起来好费劲，一遍查稳定一遍改。  
   我只是自用，自己用出问题，稍微修改一下。  
   却等不到作者更新，我就自己越改越多，然后就这样了。。。  
   ```
  
   
--- 


原作者  by：PJ小宇    QQ：898811295

修改    by：风中拾叶

三改   by：wengzhenquan（就是俺啦）   
github：https://github.com/wengzhenquan/autojs6


---  

v3.4.6：
1. 跳过广告

v3.4.5：
1. 添加服务器提前异步检查。  
2. 小小的优化，不值一提。

v3.4.4：
1. 修复了一些兼容性bug，主要针对旧版安卓。  
2. 添加多台服务器验证，优化逻辑，增加可行性、可用性。

v3.4.3：
1. 兼容旧版本安卓。  
2. 美化日志，适应旧版安卓。  
3. 修复装逼控制台样式失效问题。
4. AutoJS 6.5.0兼容性改造。

v3.4.2：
1. 添加社区APP、微信版本号验证。

v3.4.1：
1. 修改一些日志文案。
2. 左下角，添加停止脚本悬浮窗按钮。

v3.4:
1. 添加异常打印输出。  
2. 优化小程序摸黑签到逻辑。
3. 添加通知静音、结束震动配置。
4. 添加小程序摸黑签到自定义坐标。
5. 删除已弃用的配置，con、totaltime，这两货在程序里也是没用的一段代码。


v3.3:
1. 添加设置媒体静音功能。   
2. 添加设置运行屏幕亮度功能。   
3. 修复小程序布局分析失败时，卡主问题。   
4. 添加布局分析失败，从社区APP重新打开逻辑。   
5. 调整运行顺序：   
    APP签到完→小程序签到（去除小程序成长值统计）；  
    开盒子放到最后，以免小程序签到完，成长值又足够开盒子；  
    成长值数据，只用社区APP统计，放在程序最后，以免小程序统计不准确；  
(看起来好乱！)

v3.2.3:
1. 修复微信模拟进入小程序下滑失败问题。
2. 修复微信分身下，APP调用小程序识别错误。
3. 修复自适配分辨率坐标没点击问题。

v3.2.2:
1. 优化一些识别逻辑。
2. 添加屏幕解锁失败重试逻辑。
3. 提高识图签到自适应分辨率准确度。
4. 修复微信分身下，APP调用小程序识别错误。

v3.2.1:
1. 调整控制台，在签到页控制台高度收缩为20%，签到完成恢复。 
2. 等待小程序打开时间延长到10秒。 
3. 请求服务器超时改为10秒，且添加@风中拾叶大佬的请求地址。   
4. 服务器部分优化，加快请求速度。  
5. 主程序改名为“小社脚本”，就是“小（米）”、“社（区）”各留第一个字。  
(改名主要是看到风中拾叶的脚本开始用跟本脚本一样的命名规则，加个v，这样就不好共存了啊！)  

v3.2:
1. 延长从社区APP调用小程序的等待时间。
2. 终于实现识图签到了，是风中拾叶写的Python，和训练的模型。
（几经波折，由于AutoJS6不支持调用模型，所以最后把模型放在了服务器上跑，需要请求服务器，需要4~7秒的时间。）
（虽然删除了hk目录，但是滑块签到的逻辑还是保留的，转移到tmp路径，反正已经实现自动适配了。说不定哪天小米又换过来了呢？）
（感谢@风中拾叶 大佬（@fgvsuiye）的辛苦奉献）


 [更新历史](说明/更新历史.md)
