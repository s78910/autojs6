******************************************************************
*   __autojs需要各种权限，左侧边栏内的权限都打开可解决大部分问题！！__

*   __部分手机需要打开 后台弹出界面  的权限，否则无法自动启动社区__

*    __需将验证码界面截图，自行裁切滑块保存hk.png__

*    __$\color{red}{小提示：聪明的用户，每次更新自己下载主程序js文件就行了！}$__

*    __$\color{red}{没有新增活动之前，配置文件都不会改！}$__

*    __$\color{red}{每次更新，也会换主程序文件名，完全可以放在同一个目录下共存！}$__

*    __$\color{red}{历史版本，去切换github分支，查看！}$__
******************************************************************



原作者@PJxiaoyu、@fgvsuiye

# 小米社区自动签到脚本！
**功能：锁屏自动解锁，浏览帖子，签到，过滑块验证，小程序签到等。**  

支持从5.3.0以上社区APP调用小程序，也支持自动搜索小程序坐标。

（执行有一定的错误率，建议**定时任务执行两次** 。有bug提交，提供日志截图。）  
（有的问题是autojs6的问题，autojs6有时识别不到组件，重启手机就能解决。）

[脚本下载入口](https://github.com/wengzhenquan/autojs6/releases)

1080分辨率可用，其它分辨率可能出错。需要替换hg.png图片。

建议使用autojs6最新版  
[点击下载](https://github.com/SuperMonster003/AutoJs6/releases)  


--- 
## 使用方法：  
1. 先授权autojs6需要的权限。  
   没root就开启“无障碍服务”，免root建议Shizuku体验更好。  
   有root推荐授权root权限。  
   页面需要的权限如下：
    ![image](说明/需要的权限.jpg)  

2. 更改autojs6工作路径。  
   允许使用中文，目录在sdcard/下。  
![image](说明/更改工作路径.jpg)  


3. 将脚本解压到工作路径下。  
   你可以修改文件夹名称，里面的文件别改名就行。  
 


4. 在autojs6找到脚本，脚本如下：  
   ![image](说明/主界面.jpg)  


6. 编辑配置文件：  
   ![image](说明/配置文件说明.jpg)  

   配置文件里面都有详细说明：
   
   设置屏幕解锁密码，能够设置定时任务，在夜间自动解锁进行签到，依葫芦画瓢，有多少个点位，就多少行[横坐标x, 纵坐标y]。  
   按解锁顺序，从上到下排列。
   
   图形锁的坐标获取：autojs6→菜单→浮动按钮（第3个），会看到一个小悬浮窗小工具。小工具→…→指针位置。    
   ![image](说明/获取坐标工具.jpg)  
   当然，如果是数字密码，将“解锁方式”改成2，里面有说明。  
   
   
7. 替换hk.png文件。  
   $\color{red}{（非2400*1080分辨率的手机请注意，是这个分辨率的不用管。）}$
    
   
   这张图片是在1080分辨率的手机下截图的，如果你的手机不是这个分辨率，你可能需要自己截图剪切一张。  
   该图片用于自动滑块验证。来自小米社区签到页面的滑块截图。  
   
   
   
9.  ~~小米社区小程序，必须放在第3屏~~  
   **（小米社区APP 5.3.0以上版本可不用该操作）。**  
   ~~在微信小程序里面，右上角“…”→添加到桌面，然后把图标移动到第3屏即可。~~  
   可以通过填写坐标的方式指定位置，坐标获取方法与上面一样。  
   
 
   小米社区微信小程序调用优先级：  
   从小米社区APP调用 > 第3屏指定”坐标”寻找（如果配置“坐标点击: 1,”） > 自动搜索第3屏（配置“坐标点击: 0,”）  
   小米社区APP 5.3.0以上版本才支持直接调用。  
      
   
10. 你还等什么？哪来的9？赶快启动试试啊！成功了就定时任务甩起！
   
   **记得定时任务两次，两次间隔3分钟以上，免得运行出错，错过签到。** 

----   
## 问题收集：
   1. 为什么小程序打开了没有动作？为什么不会自动打开“小米社区”APP？  
   
   遇到这个问题应该是root用户，  
   并且使用了“隐藏应用列表”（lsposed），  
   当autojs6在隐藏应用列表中的时候，开启了数据隔离，  
   可能会造成对微信小程序、小米社区APP不可见，或者识别受阻现象。  
   ```
   解决：打开“隐藏应用列表”→应用管理→autojs6
   →开启白名单→额外可见的应用{微信、小米社区}，即可！
   ```
   2. 要开始使用AutoJs6录制或投放内容吗？每次需要手动点“立即开始”。
     
   需要开启“投影媒体权限”，才能自动跳过这一步。
   ```
   有电脑：下载adb工具，复制开启“投射媒体权限”的命令执行，相关过程自行查询。
   
   无root，不想用电脑：可通过使用 Shizuku 获得 ADB 特权，可直接开启。
   
   root用户：授权AutoJs6root权限，直接开启。
   ```

   3. 为什么有时候报错，有时候又正常？
     
   这跟AutoJs6、手机有关系。
   
   AutoJs6的因素：
   ```
   1、 每个版本略有差异，脚本是靠AutoJs6识别组件位置和层次。
      有的版本识别会缺一层，导致父组件不对。影响整体组件次序。
      我已经尽量做到改成兼容性强的方式来识别，但依旧有个别改不了。
      
   2、 AutoJs6使用多次会卡，导致内存堆积，拖慢整个手机。
       需要重启AutoJs6才能恢复。
       脚本里为了提升效率，寻找组件时间设置了限时，
       由于手机变慢，导致识别也会出现错误，甚至负值的坐标。
   ```
   手机的因素：
   ```
   1、 这种模拟脚本，不能直接调用接口的，失误率很高。
       不仅仅是误触问题，分辨率、主题布局，程序切换动画，都会有些影响。
       比如说，调用小米社区，APP不知道从哪个角落飞过来，
       动画长了点，然后脚本识别的又着急，可能识别到的瞬间，你动画还没停下，
       识别的坐标，变成“刻舟求剑”了！
       
   2、 手机环境也有影响。我手机“无障碍”残疾人就经常掉，开启状态不生效是什么鬼？
       因为要兼容免root，我关闭了对AutoJs6的root授权，结果老出问题。
       好像root开启之后，问题变得很少。我的“无障碍”有些问题，包括gkd也是有问题的。     
   ```


--- 
## 作者的废话：
   ```
   我做的最多的修改，就是“大改”！！！  
   多次测试，中途遇到各种意外不能执行下去，都写了补偿方案。  
   要么循环调用，反复尝试。  
   要么换一种写法，要么干脆另辟蹊径再添加一种实现逻辑，实现plan B。  
   
   比如说，有时候直接调用小米社区失败。  
   反复调都不行，多次尝试后就找别的入口点击打开。  
   有时候进入微信小程序，无法直接进入，却启动了微信，那就模拟从小程序使用记录里面找。  
   有时候没问题，有时候又不行，根本不知道到底是什么原因导致的不稳定。  
   
   不论如何，我的建议是设置两个定时任务。  
   每个间隔3分钟以上（正常走完一次，2分钟内能执行完毕）。  
   多次执行，就不怕漏签了。或者早上几个，晚上几个，多多益善。  
   
   由于我就一部手机，没那么多测试用例可以测试，不过我真不想折腾了。  
   我又不是前端开发，不懂JS，该起来好费劲，一遍查稳定一遍改。  
   我只是自用，自己用出问题，稍微修改一下。  
   却等不到作者更新，我就自己越改越多，然后就这样了。。。  
   ```
  
   
--- 
/*

原作者  by：PJ小宇    QQ：898811295

修改    by：风中拾叶

三改   by：wengzhenquan
github：https://github.com/wengzhenquan/autojs6

*/
---  

v20250319修改内容如下:
1. 启动小米社区APP，优化补偿方案
2. 小部分修改，大部分修改。
3. 我也不知道改了啥，好多气泡就是不出来，好累，不想改了！
4. 分支线程为什么不能异步调用弹出气泡？放弃了，搞不定！
5. 通知有毛病吧，作者文档写的api有些不能调用啊！为什么我放在另一个方法体就报错了？
6. 我既不会JS，也不会安卓开发，好难啊！
7. QQ被封号斗罗了，荣获七环封号斗罗，(ಥ_ಥ)  


v20250318修改内容如下:
1. 优化速度，修改许多地方
2. 加强 浏览帖子 逻辑，添加前置环境矫正、打开帖子校验
3. 修改从小程序统计成长值、每日增长计算逻辑。


v20250317修改内容如下:
1. 将/Pictures目录修改到当前路径下tmp目录
2. 优化从APP调用进入小程序逻辑，补充容错方案
3. 添加toastLog提示框输出  



v20250316修改内容如下:

1. 添加首次运行时，链式调用小米社区APP，自动点击“始终允许”
2. 修复双旗舰活动，页面无法关闭问题



v20250315修改内容如下:

1. 修复bug，优化代码。
2. 调换签到顺序，将小程序签到放到最后。
3. 支持5.3.0版本小米社区，从社区APP调用小程序。  
（如果存在微信分身，默认选第1个微信；保留第3屏小程序逻辑）


v20250314修改内容如下:

1. 优化部分代码，提高效率，提高可用性、兼容性。
2. 修复自动寻找“小米社区小程序”逻辑。
3. 注释掉已经下线的活动。
4. 兼容最新版autojs6


